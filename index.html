<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>App Entregas - Modo Teste</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --azul: #1976d2;
  --azul-claro: #e3f2fd;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

/* HEADER */
header {
  background: var(--azul);
  color: white;
  padding: 14px;
  text-align: center;
  font-size: 18px;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 100;
}

/* MAPA */
#map {
  width: 100%;
  height: 320px;
  margin-top: 10px;
  border-radius: 10px;
}

/* BOTÃƒO */
button {
  width: 90%;
  margin: 12px auto;
  display: block;
  padding: 14px;
  background: var(--azul);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
}

/* LISTA */
ul {
  list-style: none;
  padding: 10px;
}

li {
  background: white;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
}

.status {
  font-weight: bold;
  color: var(--azul);
}

.tempo {
  color: #555;
  font-size: 14px;
}
</style>
</head>

<body>

<header>ðŸš´ Entregador Online</header>

<div id="map"></div>

<button onclick="criarCorrida()">âž• Criar corrida (teste)</button>

<ul id="lista"></ul>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  projectId: "SEU_PROJECT_ID"
});
const db = firebase.firestore();

/* MAPA */
let map;
let entregadorMarker;
let directionsService;
let directionsRenderer;
let inicioUso = Date.now();

/* TEMPO DE USO */
function tempoUso() {
  let seg = Math.floor((Date.now() - inicioUso) / 1000);
  return `${Math.floor(seg/60)}m ${seg%60}s`;
}

/* INICIAR GPS */
function iniciarGPS() {
  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(pos => {
      const p = { lat: pos.coords.latitude, lng: pos.coords.longitude };
      if (!entregadorMarker) {
        entregadorMarker = new google.maps.Marker({
          position: p,
          map: map,
          icon: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png",
          title: "VocÃª (entregador)"
        });
        map.setCenter(p);
      } else {
        entregadorMarker.setPosition(p);
      }
    }, err => {
      alert("Erro ao pegar GPS");
    }, { enableHighAccuracy: true });
  } else {
    alert("GPS nÃ£o suportado pelo navegador");
  }
}

/* INICIAR MAPA */
function iniciarMapa() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: -23.55, lng: -46.63 },
    zoom: 14
  });
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);

  iniciarGPS();
  ouvirCorridas();
}

/* CRIAR CORRIDA TESTE */
function criarCorrida() {
  const origem = {
    lat: -23.55 + Math.random()/100,
    lng: -46.63 + Math.random()/100
  };
  const destino = {
    lat: -23.56 + Math.random()/100,
    lng: -46.64 + Math.random()/100
  };

  db.collection("corridas").add({
    origem,
    destino,
    status: "disponÃ­vel",
    criado: Date.now()
  });
}

/* OUVIR CORRIDAS (TEMPO REAL) */
function ouvirCorridas() {
  db.collection("corridas").orderBy("criado", "desc").onSnapshot(snapshot => {
    document.getElementById("lista").innerHTML = "";
    snapshot.forEach(doc => {
      const c = doc.data();
      const id = doc.id;

      document.getElementById("lista").innerHTML += `
        <li>
          <div class="status">Status: ${c.status}</div>
          <div class="tempo">Tempo no app: ${tempoUso()}</div>
          <button onclick="aceitarCorrida('${id}', ${c.destino.lat}, ${c.destino.lng})">
            Aceitar corrida
          </button>
        </li>
      `;
    });
  });
}

/* ACEITAR CORRIDA E DESENHAR ROTA */
function aceitarCorrida(id, dlat, dlng) {
  db.collection("corridas").doc(id).update({
    status: "aceita"
  });

  directionsService.route({
    origin: entregadorMarker.getPosition(),
    destination: { lat: dlat, lng: dlng },
    travelMode: "DRIVING"
  }, (res, status) => {
    if (status === "OK") {
      directionsRenderer.setDirections(res);
    }
  });

  alert("Corrida aceita (modo teste)");
}
</script>

<!-- GOOGLE MAPS -->
<script
src="https://maps.googleapis.com/maps/api/js?key=SUA_CHAVE_GOOGLE_MAPS&callback=iniciarMapa"
async defer></script>

</body>
</html>
