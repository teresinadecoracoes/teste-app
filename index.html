<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>App Entregas - Modo Teste</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- LEAFLET CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
:root {
  --azul: #1976d2;
  --verde: #2e7d32;
  --laranja: #f57c00;
  --cinza: #f2f2f2;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--cinza);
}

/* HEADER */
header {
  background: var(--azul);
  color: white;
  padding: 16px;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#saldo {
  font-weight: normal;
  font-size: 16px;
}

/* MAPA */
#map {
  width: 100%;
  height: 300px;
  margin: 10px 0;
  border-radius: 10px;
}

/* LISTA */
ul {
  list-style: none;
  padding: 10px;
}

li {
  background: white;
  padding: 14px;
  margin-bottom: 12px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
  display: flex;
  flex-direction: column;
}

.status {
  font-weight: bold;
  margin-bottom: 6px;
}

.status.disponivel { color: var(--verde); }
.status.aceita { color: var(--laranja); }
.status.concluida { color: gray; }

.tempo, .valor {
  font-size: 14px;
  color: #555;
}

button.acao {
  margin-top: 8px;
  background: var(--laranja);
  color: white;
  border: none;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  üö¥ Entregador Online
  <div id="saldo">Saldo: R$ 0,00</div>
</header>

<div id="map"></div>

<ul id="lista"></ul>

<!-- LEAFLET JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- LEAFLET ROUTING -->
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<script>
// MAPA
let map = L.map('map').setView([-23.55, -46.63], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let entregadorMarker = L.marker([-23.55, -46.63]).addTo(map).bindPopup("Voc√™ (entregador)").openPopup();
let rotaControl;

let saldo = 0;
let corridas = [];

// TEMPO
function tempoUso(ms) {
  let seg = Math.floor(ms/1000);
  return `${Math.floor(seg/60)}m ${seg%60}s`;
}

// CRIAR CORRIDA TESTE ALEATORIA
function criarCorrida() {
  const origem = [-23.55 + Math.random()/100, -46.63 + Math.random()/100];
  const destino = [-23.56 + Math.random()/100, -46.64 + Math.random()/100];
  const valor = (Math.random()*15 + 5).toFixed(2); // valor entre 5 e 20
  const criado = Date.now();

  const corrida = {origem, destino, valor, criado, status:'disponivel'};
  corridas.unshift(corrida); // adiciona no come√ßo
  atualizarLista();
}

// ATUALIZAR LISTA
function atualizarLista() {
  const lista = document.getElementById('lista');
  lista.innerHTML = '';
  corridas.forEach((c, idx) => {
    let botao = '';
    if(c.status==='disponivel') {
      botao = `<button class="acao" onclick="aceitarCorrida(${idx})">Aceitar corrida</button>`;
    }
    lista.innerHTML += `
      <li>
        <div class="status ${c.status}">Status: ${c.status}</div>
        <div class="valor">Valor: R$ ${c.valor}</div>
        <div class="tempo">Tempo no app: ${tempoUso(Date.now()-c.criado)}</div>
        ${botao}
      </li>
    `;
  });
}

// ACEITAR CORRIDA
function aceitarCorrida(idx) {
  const c = corridas[idx];
  c.status = 'aceita';
  saldo += parseFloat(c.valor);
  document.getElementById('saldo').innerText = `Saldo: R$ ${saldo.toFixed(2)}`;

  // remover rota anterior
  if(rotaControl) rotaControl.remove();

  // desenhar rota no mapa
  rotaControl = L.Routing.control({
    waypoints: [
      L.latLng(entregadorMarker.getLatLng().lat, entregadorMarker.getLatLng().lng),
      L.latLng(c.destino[0], c.destino[1])
    ],
    routeWhileDragging: true
  }).addTo(map);

  atualizarLista();
}

// GERAR CORRIDAS AUTOM√ÅTICAS A CADA 5 SEGUNDOS
setInterval(criarCorrida, 5000);

// OPCIONAL: gerar algumas corridas iniciais
for(let i=0;i<3;i++) criarCorrida();
</script>

</body>
</html>
